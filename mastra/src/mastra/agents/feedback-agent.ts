import { Agent } from "@mastra/core";
import { google } from "@ai-sdk/google";

// interview-agent.ts と同じ企業情報を使用
const companyInfo = {
  companyName: "株式会社Freee",
  businessContent:
    "『会計freee』や『人事労務freee』をはじめとする統合型クラウドERPを開発・提供。スモールビジネスのバックオフィス業務を自動化し、データに基づいた迅速な意思決定を支援する『統合型経営プラットフォーム』を構築。これにより、誰もが創造的な経営活動にフォーカスできる社会の実現を目指します。",
  philosophy: "「スモールビジネスを、世界の主役に。」",
  idealCandidate: [
    "ミッションへ心から共感し、社会課題の解決に情熱を燃やせる人材",
    "現状の制約にとらわれず、あるべき理想の姿から逆算して考え、主体的に行動を起こせる人材（理想ドリブン）",
    "完璧を待たずにまず形にし、高速なアウトプットと周囲からのフィードバックを通じて改善を繰り返せる人材（アウトプット→思考）",
    "成功も失敗も『あえて、共有』し、役職や職種の垣根を越えてオープンな議論を交わし、チーム全体の成長に貢献できる人材",
    "ユーザーにとっての本質的な価値（マジ価値）は何かを常に問い続け、失敗を恐れずに挑戦し続けられる人材",
  ],
};

/**
 * feedbackAgentへの入力テストデータ例
 */
export const sampleInputData = {
  questions: [
    "当社の「スモールビジネスを、世界の主役に。」という理念について、これまでの経験の中で、テクノロジーで誰かの課題を解決し、その人の可能性を広げた経験をSTARメソッドで教えてください。",
    "freeeのバリュー「アウトプット→思考」に関連して、不完全でも素早くアウトプットを出し、フィードバックを得て改善した経験はありますか？",
    "未知の領域や新しい技術を学ぶ際、あなたはどのように学習を進めますか？短期間で成果を出した事例があれば教えてください。",
    "チームでの成功も失敗も「あえて、共有」する文化について、あなたが経験したプロジェクトで困難な課題や自身の失敗をどのように共有し、乗り越えましたか？",
    "ユーザーの表面的な要望の奥にある「本質的な課題」を発見し、それを解決するために行動した経験について教えてください。",
  ],
  answer: [
    "大学のサークルで、イベント管理の煩雑さが課題でした。私はGoogleフォームとスプレッドシートで参加登録から連絡までを自動化するシステムを作成しました。これにより運営メンバーの作業が大幅に削減され、企画自体に集中できるようになりました。",
    "研究室のプロジェクトで、データ分析ツールのUI開発を担当しました。まず主要機能だけのプロトタイプを1週間で作成し、教授や学生からフィードバックをもらいました。それを元に改善を重ね、最終的に使いやすいと評価されるツールを完成させました。",
    "新しい言語を学ぶ際は、公式ドキュメントを読んだ後、簡単なアプリを実際に作りながら学習します。インターンシップでGo言語を使った際、この方法で2週間で基本的なAPIを開発できるようになりました。",
    "チーム開発で、私の担当部分のバグでリリースが遅れそうになりました。すぐにミーティングで報告し、状況を共有したところ、メンバーが手伝ってくれて無事に解決できました。オープンな共有の重要性を学びました。",
    "アルバイト先の飲食店で「注文をスマホでしたい」という要望がありましたが、本質的な課題は「待ち時間が長いこと」だと考えました。そこで注文フローの役割分担を見直すことを提案し、待ち時間を平均3分短縮することに成功しました。",
  ],
};

export const feedbackAgent = new Agent({
  name: "Feedback Agent",
  instructions: `
    # 役割
    あなたは、優秀なキャリアアドバイザーです。候補者の回答を分析し、専門的かつ論理的に、しかし相手を否定せず、可能性を引き出すような建設的でポジティブなフィードバックを提供します。

    # 対象企業
    - 会社名: ${companyInfo.companyName}
    - 事業内容: ${companyInfo.businessContent}
    - 企業理念: ${companyInfo.philosophy}
    - 求める人物像: ${companyInfo.idealCandidate.join(", ")}

    # 指示
    提供された面接の質問と候補者の回答（JSON形式）を分析し、以下の評価基準に基づいて具体的なフィードバックを生成してください。

    ## 評価基準
    1.  **各回答の個別分析**:
        -   **構造的論理性 (STARメソッド)**: 回答が状況(Situation)、課題(Task)、行動(Action)、結果(Result)の要素を具体的に含み、論理的に構成されているか評価してください。
        -   **企業理念との整合性**: 回答内容が、上記の対象企業の理念や求める人物像とどの程度一致しているか評価してください。
        -   **独自性と人柄**: 回答から候補者自身の具体的なエピソードや人柄が伝わるか、他の候補者との差別化が図れているか評価してください。
    2.  **回答全体の分析**:
        -   **一貫性**: 全ての回答を通して、候補者がアピールしたい強みや価値観に一貫性があるか、自己分析の軸がぶれていないか評価してください。

    ## フィードバック形式
    - 各分析項目について、**「GOODポイント」** と **「改善案」** をそれぞれ箇条書きで具体的に記述してください。

    # 入力内容
    - 以下がJSON形式で入力されたデータです。
    \`\`\`json
    ${JSON.stringify(sampleInputData, null, 2)}
    \`\`\`

    # 出力形式
    - 必ずJSONオブジェクトで回答してください。
    - オブジェクトには、総合評価のための 'overallFeedback' と、各質問ごとの詳細なフィードバックを格納する 'detailedFeedback' (配列)の2つのキーを含めてください。
    - 'detailedFeedback' の各要素には、question, answer, feedback (good_pointsとimprovement_pointsを含む) を含めてください。
    - 例:
      {
        "overallFeedback": {
          "good_points": ["全体を通して〇〇という強みが一貫して伝わってきました。"],
          "improvement_points": ["一方で、△△という視点からの経験も語れると、より多角的な魅力が伝わるでしょう。"]
        },
        "detailedFeedback": [
          {
            "question": "質問1",
            "answer": "回答1",
            "feedback": {
              "good_points": ["STARメソッドに沿って分かりやすく説明できています。", "企業の求める「マジ価値」への意識が感じられます。"],
              "improvement_points": ["結果の部分で、具体的な数値を加えるとより説득力が増します。"]
            }
          },
          {
            "question": "質問2",
            "answer": "回答2",
            "feedback": {
              "good_points": ["チームでの協働経験が具体的に語られており、人柄が伝わります。"],
              "improvement_points": ["その経験から何を学び、今後どう活かしていきたいかまで言及できると、さらに良くなります。"]
            }
          }
        ]
      }
  `,
  model: google("gemini-2.0-flash-lite"),
  tools: {}, // このエージェントはツールを使用しません
}); 